<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Breakout</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #0b0b0b; }
    canvas { display: block; margin: auto; touch-action: none; }
    
    /* Game Over Overlay */
    #gameOverOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(11, 11, 11, 0.95);
      z-index: 100;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: sans-serif;
      color: #6cff00;
    }
    #gameOverOverlay.show { display: flex; }
    #gameOverOverlay h1 { font-size: 2.5rem; margin-bottom: 1rem; }
    #gameOverOverlay .final-score { font-size: 1.5rem; margin-bottom: 1.5rem; }
    #gameOverOverlay input {
      background: #0b0b0b;
      border: 2px solid #6cff00;
      color: #6cff00;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      width: 200px;
      text-align: center;
      margin-bottom: 1rem;
    }
    #gameOverOverlay input::placeholder { color: #3a7a00; }
    #gameOverOverlay button {
      background: #6cff00;
      color: #0b0b0b;
      border: none;
      padding: 0.75rem 2rem;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 2rem;
    }
    #gameOverOverlay button:hover { background: #5de000; }
    
    /* Leaderboard */
    #leaderboard {
      background: #0b0b0b;
      border: 2px solid #6cff00;
      padding: 1rem 1.5rem;
      max-width: 280px;
      width: 90%;
    }
    #leaderboard h2 { font-size: 1.2rem; margin-bottom: 0.75rem; text-align: center; }
    #leaderboard ol {
      list-style-position: inside;
      padding: 0;
    }
    #leaderboard li {
      display: flex;
      justify-content: space-between;
      padding: 0.3rem 0;
      border-bottom: 1px solid #1a3300;
    }
    #leaderboard li:last-child { border-bottom: none; }
    #leaderboard .name { flex: 1; overflow: hidden; text-overflow: ellipsis; }
    #leaderboard .score-val { font-weight: bold; margin-left: 1rem; }
  </style>
</head>
<body>
<canvas id="game"></canvas>

<div id="gameOverOverlay">
  <h1 id="gameOverTitle">Game Over</h1>
  <div class="final-score">Score: <span id="finalScore">0</span></div>
  <input type="text" id="playerName" placeholder="Enter your name" maxlength="15">
  <button id="submitScore">Save & Play Again</button>
  <div id="leaderboard">
    <h2>üèÜ Top 10 High Scores</h2>
    <ol id="highScoreList"></ol>
  </div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const ACCENT = '#6cff00';
const BG = '#0b0b0b';

let W, H, scale;
let paddleW, paddleH, paddleX, paddleY;
let ballR, ballX, ballY, ballDX, ballDY;
let brickRows = 5, brickCols = 8, brickW, brickH, brickPad, brickOffsetTop, brickOffsetLeft;
let bricks = [];
let score = 0, lives = 3, gameOver = false, won = false;

// High Score Functions
function getHighScores() {
  const data = localStorage.getItem('breakoutHighScores');
  return data ? JSON.parse(data) : [];
}

function saveHighScore(name, playerScore) {
  const scores = getHighScores();
  scores.push({ name: name || 'Anonymous', score: playerScore });
  scores.sort((a, b) => b.score - a.score);
  const top10 = scores.slice(0, 10);
  localStorage.setItem('breakoutHighScores', JSON.stringify(top10));
  return top10;
}

function renderLeaderboard() {
  const scores = getHighScores();
  const list = document.getElementById('highScoreList');
  if (scores.length === 0) {
    list.innerHTML = '<li style="justify-content:center;">No scores yet!</li>';
  } else {
    list.innerHTML = scores.map((s, i) => 
      `<li><span class="name">${i + 1}. ${s.name}</span><span class="score-val">${s.score}</span></li>`
    ).join('');
  }
}

function showGameOverScreen() {
  document.getElementById('gameOverTitle').textContent = won ? 'You Win!' : 'Game Over';
  document.getElementById('finalScore').textContent = score;
  document.getElementById('playerName').value = '';
  renderLeaderboard();
  document.getElementById('gameOverOverlay').classList.add('show');
  document.getElementById('playerName').focus();
}

function hideGameOverScreen() {
  document.getElementById('gameOverOverlay').classList.remove('show');
}

document.getElementById('submitScore').addEventListener('click', () => {
  const name = document.getElementById('playerName').value.trim();
  saveHighScore(name, score);
  hideGameOverScreen();
  initGame();
});

document.getElementById('playerName').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') document.getElementById('submitScore').click();
});

function resize() {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
  scale = Math.min(W / 480, H / 640);
  paddleW = 80 * scale;
  paddleH = 12 * scale;
  paddleY = H - 40 * scale;
  ballR = 8 * scale;
  brickPad = 6 * scale;
  brickOffsetTop = 50 * scale;
  brickOffsetLeft = 20 * scale;
  brickW = (W - brickOffsetLeft * 2 - brickPad * (brickCols - 1)) / brickCols;
  brickH = 18 * scale;
}

function initGame() {
  resize();
  paddleX = (W - paddleW) / 2;
  ballX = W / 2;
  ballY = paddleY - ballR - 2;
  ballDX = 3 * scale * (Math.random() > 0.5 ? 1 : -1);
  ballDY = -4 * scale;
  score = 0; lives = 3; gameOver = false; won = false;
  bricks = [];
  for (let r = 0; r < brickRows; r++) {
    bricks[r] = [];
    for (let c = 0; c < brickCols; c++) {
      bricks[r][c] = { x: 0, y: 0, alive: true };
    }
  }
}

function drawBricks() {
  for (let r = 0; r < brickRows; r++) {
    for (let c = 0; c < brickCols; c++) {
      const b = bricks[r][c];
      if (!b.alive) continue;
      b.x = brickOffsetLeft + c * (brickW + brickPad);
      b.y = brickOffsetTop + r * (brickH + brickPad);
      ctx.fillStyle = ACCENT;
      ctx.fillRect(b.x, b.y, brickW, brickH);
    }
  }
}

function drawPaddle() {
  ctx.fillStyle = ACCENT;
  ctx.fillRect(paddleX, paddleY, paddleW, paddleH);
}

function drawBall() {
  ctx.beginPath();
  ctx.arc(ballX, ballY, ballR, 0, Math.PI * 2);
  ctx.fillStyle = ACCENT;
  ctx.fill();
  ctx.closePath();
}

function drawHUD() {
  ctx.fillStyle = ACCENT;
  ctx.font = `${14 * scale}px sans-serif`;
  ctx.fillText(`Score: ${score}`, 10, 24 * scale);
  ctx.fillText(`Lives: ${lives}`, W - 80 * scale, 24 * scale);
}

function collisionDetection() {
  for (let r = 0; r < brickRows; r++) {
    for (let c = 0; c < brickCols; c++) {
      const b = bricks[r][c];
      if (!b.alive) continue;
      if (ballX > b.x && ballX < b.x + brickW && ballY - ballR < b.y + brickH && ballY + ballR > b.y) {
        ballDY = -ballDY;
        b.alive = false;
        score++;
        if (score === brickRows * brickCols) { won = true; gameOver = true; showGameOverScreen(); }
      }
    }
  }
}

function update() {
  if (gameOver) return;
  ballX += ballDX;
  ballY += ballDY;
  // walls
  if (ballX + ballR > W || ballX - ballR < 0) ballDX = -ballDX;
  if (ballY - ballR < 0) ballDY = -ballDY;
  // paddle
  if (ballY + ballR >= paddleY && ballX > paddleX && ballX < paddleX + paddleW) {
    ballDY = -Math.abs(ballDY);
    let hit = (ballX - paddleX) / paddleW - 0.5;
    ballDX = hit * 6 * scale;
  }
  // bottom
  if (ballY - ballR > H) {
    lives--;
    if (lives <= 0) { gameOver = true; showGameOverScreen(); }
    else { ballX = W / 2; ballY = paddleY - ballR - 2; ballDX = 3 * scale * (Math.random() > 0.5 ? 1 : -1); ballDY = -4 * scale; }
  }
  collisionDetection();
}

function draw() {
  ctx.fillStyle = BG;
  ctx.fillRect(0, 0, W, H);
  drawBricks();
  drawPaddle();
  drawBall();
  drawHUD();
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

// Controls
function movePaddle(x) {
  paddleX = x - paddleW / 2;
  if (paddleX < 0) paddleX = 0;
  if (paddleX + paddleW > W) paddleX = W - paddleW;
}
canvas.addEventListener('mousemove', e => movePaddle(e.clientX));
canvas.addEventListener('touchmove', e => { e.preventDefault(); movePaddle(e.touches[0].clientX); }, { passive: false });
window.addEventListener('resize', resize);

initGame();
loop();
</script>
</body>
</html>
